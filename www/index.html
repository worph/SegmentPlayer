<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SegmentPlayer - Media Browser</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/browse.css">
    <link rel="stylesheet" href="css/player.css">
    <link rel="stylesheet" href="css/metrics.css">
    <link rel="stylesheet" href="css/animations.css">
</head>
<body>
    <div class="container">
        <header>
            <h1 id="homeBtn">
                SegmentPlayer <span class="badge">LIVE</span>
            </h1>
            <div class="header-buttons">
                <button class="header-btn" id="metricsToggle">Metrics</button>
            </div>
        </header>

        <!-- Browse Mode: Full-page media grid -->
        <div class="browse-view" id="browseView">
            <div class="browse-header">
                <div class="browse-breadcrumb" id="browseBreadcrumb"></div>
                <div class="browse-stats" id="browseStats"></div>
            </div>
            <div class="media-grid" id="mediaGrid">
                <div class="loading">
                    <div class="spinner"></div>
                    Loading media...
                </div>
            </div>
        </div>

        <!-- Player Mode: Sidebar + Player -->
        <div class="player-view" id="playerView">
            <div class="layout">
                <!-- File Browser Sidebar -->
                <div class="file-browser">
                    <div class="file-browser-header">Media Files</div>
                    <div class="sidebar-breadcrumb" id="sidebarBreadcrumb"></div>
                    <div class="file-list" id="fileList"></div>
                </div>

                <!-- Player Section -->
                <div class="player-section">
                    <div class="video-container">
                        <video id="video" controls crossorigin="anonymous" autoplay></video>
                        <div class="controls">
                            <div class="control-group">
                                <label>Quality:</label>
                                <select id="resolutionSelect" disabled>
                                    <option value="auto">Auto</option>
                                    <option value="original">Original</option>
                                    <option value="1080p">1080p</option>
                                    <option value="720p">720p</option>
                                    <option value="480p">480p</option>
                                    <option value="360p">360p</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label>Audio:</label>
                                <select id="audioSelect" disabled>
                                    <option value="">Default</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label>Subtitles:</label>
                                <select id="subtitleSelect" disabled>
                                    <option value="">Off</option>
                                </select>
                                <span class="subtitle-loading" id="subtitleLoading">
                                    <span class="mini-spinner"></span>
                                    <span>Generating...</span>
                                </span>
                            </div>
                            <button id="downloadBtn" disabled title="Download original file">
                                <span>Download</span>
                            </button>
                            <span class="status" id="status"><span class="status-dot" id="statusDot"></span><span id="statusText">Select a file</span></span>
                        </div>
                    </div>

                    <div class="subtitle-progress" id="subtitleProgress">
                        <div class="subtitle-progress-header">
                            <span class="spinner"></span>
                            <span>Generating subtitles...</span>
                        </div>
                        <div class="subtitle-progress-bar">
                            <div class="subtitle-progress-fill" id="subtitleProgressFill"></div>
                        </div>
                        <div class="subtitle-progress-text" id="subtitleProgressText">Extracting subtitle track from video...</div>
                    </div>

                    <div class="now-playing" id="nowPlaying" style="display: none;">
                        <div class="now-playing-title">Now Playing</div>
                        <div class="now-playing-name" id="nowPlayingName"></div>
                    </div>

                    <div class="metrics-panel" id="metricsPanel">
                        <div class="metrics-section">
                            <h3>Player Mode</h3>
                            <div class="metrics-grid" style="grid-template-columns: 1fr 1fr 1fr 1fr;">
                                <div class="metric-item">
                                    <div class="metric-value" id="metricMode">-</div>
                                    <div class="metric-label">Mode</div>
                                </div>
                                <div class="metric-item">
                                    <div class="metric-value" id="metricVideoCodec">-</div>
                                    <div class="metric-label">Video</div>
                                </div>
                                <div class="metric-item">
                                    <div class="metric-value" id="metricAudioCodec">-</div>
                                    <div class="metric-label">Audio</div>
                                </div>
                                <div class="metric-item" style="display: flex; align-items: center; justify-content: center;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; font-size: 0.85rem; color: #888;">
                                        <input type="checkbox" id="forceTranscode" style="cursor: pointer;"> Force Transcode
                                    </label>
                                </div>
                            </div>
                            <div style="font-size: 0.75rem; color: #666; margin-top: 0.5rem; line-height: 1.4;">
                                <b>Repack</b>: H.264 + AAC only (fast, no CPU). <b>Transcode</b>: HEVC, AV1, VP9, AC3, DTS, 10-bit (re-encodes to H.264+AAC).
                            </div>
                        </div>
                        <div class="metrics-section">
                            <h3>Adaptive Quality <span id="adaptiveQualityRes" style="font-weight: normal; color: #888;"></span></h3>
                            <div class="adaptive-grid">
                                <div class="adaptive-item">
                                    <div class="adaptive-label">Encoder Preset</div>
                                    <div class="adaptive-value" id="metricPreset">fast</div>
                                    <div class="adaptive-bar preset-bar">
                                        <div class="adaptive-bar-fill" id="presetBar"></div>
                                    </div>
                                    <div class="adaptive-range">
                                        <span class="range-fast">ultrafast</span>
                                        <span class="range-good">veryslow</span>
                                    </div>
                                    <div class="adaptive-stats">
                                        <span class="stat-up" id="presetAdjustUp" title="Quality increases">&#9650; 0</span>
                                        <span class="stat-down" id="presetAdjustDown" title="Quality decreases">&#9660; 0</span>
                                    </div>
                                </div>
                                <div class="adaptive-item">
                                    <div class="adaptive-label">CRF Offset</div>
                                    <div class="adaptive-value" id="metricCRF">+0</div>
                                    <div class="adaptive-bar crf-bar">
                                        <div class="adaptive-bar-fill" id="crfBar"></div>
                                    </div>
                                    <div class="adaptive-range">
                                        <span class="range-good">+0 best</span>
                                        <span class="range-fast">+7 fast</span>
                                    </div>
                                    <div class="adaptive-stats">
                                        <span class="stat-up" id="crfAdjustDown" title="Quality increases">&#9650; 0</span>
                                        <span class="stat-down" id="crfAdjustUp" title="Quality decreases">&#9660; 0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="metrics-section">
                            <h3>Transcode Ratio</h3>
                            <div class="ratio-gauge">
                                <div class="ratio-bar">
                                    <div class="ratio-target" style="left: 70%; width: 10%;"></div>
                                    <div class="ratio-needle" id="ratioNeedle"></div>
                                </div>
                                <div class="ratio-labels">
                                    <span>0%</span>
                                    <span>50%</span>
                                    <span class="target-label">70-80%</span>
                                    <span>100%</span>
                                </div>
                                <div class="ratio-value" id="ratioValue">-</div>
                            </div>
                        </div>
                        <div class="metrics-section">
                            <h3>Performance</h3>
                            <div class="metrics-grid">
                                <div class="metric-item">
                                    <div class="metric-value" id="metricRatioAvg">-</div>
                                    <div class="metric-label">Avg Ratio</div>
                                </div>
                                <div class="metric-item">
                                    <div class="metric-value" id="metricRatioLast">-</div>
                                    <div class="metric-label">Last Ratio</div>
                                </div>
                                <div class="metric-item">
                                    <div class="metric-value" id="metricRatioMin">-</div>
                                    <div class="metric-label">Best</div>
                                </div>
                                <div class="metric-item">
                                    <div class="metric-value" id="metricRatioMax">-</div>
                                    <div class="metric-label">Worst</div>
                                </div>
                                <div class="metric-item">
                                    <div class="metric-value" id="metricCacheHit">-</div>
                                    <div class="metric-label">Cache Hit</div>
                                </div>
                                <div class="metric-item">
                                    <div class="metric-value" id="metricSegments">-</div>
                                    <div class="metric-label">Segments</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript modules (loaded in dependency order) -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/router.js"></script>
    <script src="js/browser.js"></script>
    <script src="js/player.js"></script>
    <script src="js/controls.js"></script>
    <script src="js/metrics.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
